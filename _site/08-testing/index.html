















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2019-03-06 17:05:53 -0500">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Scientific Programming for Computational Molecular Science"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Scientific Programming for Computational Molecular Science: Testing Code</title>
  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body pre-alpha">
    This lesson is still being designed and assembled (Pre-Alpha version)
  </div>
</div>





    <div class="container">
      






<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a href="http://molssi.org/" class="pull-left">
        <img class="navbar-logo" src="../assets/img/molssi_main_logo.png" alt="The Molecular Sciences Software Institute" />
      </a>

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-introduction/index.html">Introduction</a></li>
            
            <li><a href="../02-file_parsing/index.html">File Parsing</a></li>
            
            <li><a href="../03-multiple_files/index.html">Processing Multiple Files and Writing Files</a></li>
            
            <li><a href="../04-tabular_data/index.html">Working with Tabular Data</a></li>
            
            <li><a href="../05-plotting/index.html">Plotting and Data Visualization</a></li>
            
            <li><a href="../06-functions/index.html">Writing Functions</a></li>
            
            <li><a href="../07-command_line/index.html">Running code from the Linux Command Line</a></li>
            
            <li><a href="../08-testing/index.html">Testing Code</a></li>
            
            <li><a href="../09-git/index.html">Version Control and Sharing Code</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/index.html">About</a></li>
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit//_episodes/08-testing.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../07-command_line/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Scientific Programming for Computational Molecular Science</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../09-git/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Testing Code</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 15 min
      <br/>
      <strong>Exercises:</strong> 20 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How do I test my functions?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Write tests for user-defined functions.</p>
</li>
	
	<li><p>Use pytest to run all your tests.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="the-importance-of-testing">The Importance of Testing</h2>
<p>Beginning programmers often write a lot of code before testing it.  Testing to makes sure your code is working correctly is an essential part of the programming process.  You may have noticed that in the previous lessons, every time a new section of code was created, it was immediately tested to see if it worked correctly, sometimes by doing something as simple as printing the variable that was just read in or calculated to ensure that the code worked correctly.</p>

<p>As you write more complicated codes, testing becomes even more important.  You will need to make sure that each part of the code works correctly and that it works with the rest of the code.   Often, situations arise where new code is written and it causes an old part of the code, which was working before, to stop working.  Testing each part of your code individually is called <em>unit testing</em> and testing how the parts work together is called <em>integration testing</em> testing.  The best practice is to have unit testing that covers most of your code.</p>

<p>One way to include unit testing is to write tests that test a single function of your code.  In the last lesson, we wrote two functions in our geometry analysis project, one that calculated a bond length and one that checks to see if a particular distance corresponded to a bond.  We can now write tests for each of those functions.</p>

<h2 id="writing-unit-tests">Writing unit tests</h2>
<p>Since complicated code may have many, many tests, we are going to learn to use a python package called <code class="highlighter-rouge">pytest</code> to test our code automatically.  The <code class="highlighter-rouge">pytest</code> package automatically looks for tests in files whose name start with the word test.  Open a new file in your favorite text editor.  Name your file test_geom_analysis.py.  Just like any other python module, you have to import <code class="highlighter-rouge">pytest</code> to use it.  Since we are testing functions we wrote earlier in our geometry analysis project, we also need to import that code.  (In this section, you may have named your code or your functions slightly differently than the examples given here; that’s fine, just make sure you use adjust accordingly.)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">geom_analysis</span> <span class="k">as</span> <span class="n">ga</span>
</code></pre></div></div>
<p>Next write a function that tests your <code class="highlighter-rouge">bond_length</code> function.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def test_bond_length():
    coord1 = [0, 0, 0]
    coord2 = [1, 0, 0]
    expected = 1.0
    observed = ga.bond_length(coord1,coord2)
    assert observed == expected
</code></pre></div></div>
<p>Notice a few things about this function.  The name of our function begins with <code class="highlighter-rouge">test</code>.  This must be true for your test to run with <code class="highlighter-rouge">pytest</code>  Since the bond_length function is expecting two inputs, the coordinates of two atoms, we define those variables in our function.  We try to make the tests as simple as possible; in our real code, these coordinates will come from a list we are counting over in a <code class="highlighter-rouge">for</code> loop.  That is not necessary here; we want to make the test as simple as possible so that we can be sure which part of our code is working or not.  For instance, if we had already tested our <code class="highlighter-rouge">bond_length</code> function and we knew it was working, if our code then did not give the correct bond lengths for a molecule, we know the problem is in our <code class="highlighter-rouge">for</code> loop in the way we are passing the information to the function.  This type of information is valuable when you are trying to solve problems in your code.</p>

<p>After we define the two sets of coordinates, we create a variable called <code class="highlighter-rouge">expected</code> which is the value we expect the test to return.  We then calculate a value called <code class="highlighter-rouge">observed</code> by calling the <code class="highlighter-rouge">bond_length</code> function from our code.  The final <code class="highlighter-rouge">assert</code> statement states what should be true in our test.  If this statement is not true, our test will not pass.</p>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>
  <p>Write a function to test your <code class="highlighter-rouge">bond_check</code> function.  (The name of your function may be slightly different!)</p>

  <blockquote class="solution">
    <h2 id="answer">Answer</h2>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_bond_check</span><span class="p">():</span>
    <span class="n">bond_distance</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">bond_check</span><span class="p">(</span><span class="n">bond_distance</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">observed</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>Once you have both your functions written, save your file of tests and return to the command line.  Run <code class="highlighter-rouge">pytest</code>.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pytest -v
</code></pre></div></div>
<p>The “-v” flag stands for verbose.  It tells <code class="highlighter-rouge">pytest</code> to print more information when it runs the tests.  The output should look like this.</p>
<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>============================= test session starts ==============================
collected 2 items                                                              

test_geom_analysis.py::test_bond_length PASSED                           [ 50%]
test_geom_analysis.py::test_bond_check_true PASSED                       [100%]

=========================== 2 passed in 0.16 seconds ===========================
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="check-your-understanding">Check your Understanding</h2>
  <p>Change the <code class="highlighter-rouge">expected</code> value in your bond_length test so that the test will fail.  Run pytest again so you can see the output of a failed test.</p>

  <blockquote class="solution">
    <h2 id="answer-1">Answer</h2>
    <div class="ouput highlighter-rouge"><div class="highlight"><pre class="highlight"><code>============================= test session starts ==============================
                                                 
test_geom_analysis.py::test_bond_length FAILED                           [ 50%]
test_geom_analysis.py::test_bond_check_true PASSED                       [100%]

=================================== FAILURES ===================================
_______________________________ test_bond_length _______________________________

    def test_bond_length():
        coord1 = [0, 0, 0]
        coord2 = [1, 0, 0]
        expected = 2.0
        observed = ga.bond_length(coord1,coord2)
&gt;       assert observed == expected
E       assert 1.0 == 2.0

test_geom_analysis.py:9: AssertionError
====================== 1 failed, 1 passed in 0.41 seconds ======================
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>Don’t forget to fix your bond_length test after your activity so that it works again.</p>

<h2 id="edge-cases-and-corner-cases">Edge Cases and Corner Cases</h2>
<p>It is usually easy to think of an obvious tests that your functions should pass or fail.  However, your code is often likely to fail in more extreme cases.  The situation where the test examines either the beginning or the end of a range is called an <em>edge case</em>.  In a simple, one-dimensional problem, the two edge cases should always be tested along with at least one internal point. This ensures that you have good coverage over the range of values.  When two or more edge cases are combined, it is called a <em>corner case.</em> If a function is parametrized by two linear and independent variables, a test that is at the extreme of both variables is in a corner.</p>

<p>Let’s think some more about our testing of the <code class="highlighter-rouge">bond_check</code> function.  We are using a very simple (and arbitrary!) definition for a bond, which is that it has a length greater than 0 and less than or equal to 1.5 angstroms.  In the test we already wrote, we supplied a value between 0 and 1.5 angstroms, so the test should return True.  We already tested this behavior.  We would also like to be sure that the test returns False if we give it a value greater than 1.5 angstroms.  But what does our code do if we give exactly 0 as the value?  Exactly 1.5?  What should the function return?  These are the edge cases for this function.</p>

<blockquote class="challenge">
  <h2 id="check-your-understanding-1">Check your Understanding</h2>
  <p>What should your code return if the bond distance supplied is exactly 0 angstroms.  What about 1.5 angstroms?</p>
  <blockquote class="solution">
    <h2 id="answer-2">Answer</h2>
    <p>The 0 angstroms test should return False.  The 1.5 angstrom test should return True.</p>
  </blockquote>
</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>
  <p>Write three additional test cases for the bond_check function:  one to test that a longer bond distance is not a bond and both edge cases described above.</p>
  <blockquote class="solution">
    <h2 id="answer-3">Answer</h2>
    <p>Note that the original bond_check test has been renamed to bond_check_true.</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_bond_check_true</span><span class="p">():</span>
    <span class="n">bond_distance</span> <span class="o">=</span> <span class="mf">1.2</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">bond_check</span><span class="p">(</span><span class="n">bond_distance</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">observed</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span> <span class="nf">test_bond_check_false</span><span class="p">():</span>
    <span class="n">bond_distance</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">bond_check</span><span class="p">(</span><span class="n">bond_distance</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">observed</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span> <span class="nf">test_bond_check_0</span><span class="p">():</span>
    <span class="n">bond_distance</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">bond_check</span><span class="p">(</span><span class="n">bond_distance</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">observed</span> <span class="o">==</span> <span class="n">expected</span>

<span class="k">def</span> <span class="nf">test_bond_check_1_5</span><span class="p">():</span>
    <span class="n">bond_distance</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">bond_check</span><span class="p">(</span><span class="n">bond_distance</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">observed</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>    </div>

    <p>All of these tests should pass.  If they do not, it is probably due to a mistake in how your <code class="highlighter-rouge">bond_check</code> function is defined.  Check your function and adjust accordingly.  A common mistake is that your bond_check function only returns True and does not have an else statement to return False if the bond length doesn’t check out.</p>
  </blockquote>
</blockquote>


<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>The python package pytest looks for functions that start with <em>test</em> to run.</p>
</li>
    
    <li><p>It is particularly important to write tests for the edge and corner cases of your functions.</p>
</li>
    
    <li><p>While writing tests can seem time consuming, they are essential to writing good code.  Testing is particularly important when multiple people are collaborating on a complex code.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../07-command_line/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../09-git/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
        Copyright &copy; 2018–2019
	<a href="http://molssi.org">The Molecular Sciences Software Institute</a>
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit/gh-pages/_episodes/08-testing.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:education@molssi.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.0">9.5.0</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
